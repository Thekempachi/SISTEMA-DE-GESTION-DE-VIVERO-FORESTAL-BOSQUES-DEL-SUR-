# Configuración para Sistema de Gestión de Vivero
# Apache .htaccess

# Habilitar reescritura de URLs
RewriteEngine On

# Configuración de tipos MIME para archivos estáticos
<IfModule mod_mime.c>
    AddType text/css .css
    AddType application/javascript .js
    AddType application/json .json
    AddType image/svg+xml .svg
</IfModule>

# Configuración de headers para archivos estáticos
<IfModule mod_headers.c>
    # CSS files
    <FilesMatch "\.(css)$">
        Header set Content-Type "text/css; charset=utf-8"
        Header set Cache-Control "public, max-age=31536000"
    </FilesMatch>
    
    # JavaScript files
    <FilesMatch "\.(js)$">
        Header set Content-Type "application/javascript; charset=utf-8"
        Header set Cache-Control "public, max-age=31536000"
    </FilesMatch>
    
    # HTML files
    <FilesMatch "\.(html)$">
        Header set Content-Type "text/html; charset=utf-8"
        Header set Cache-Control "no-cache, no-store, must-revalidate"
    </FilesMatch>
    
    # PHP files (API)
    <FilesMatch "\.(php)$">
        Header set Content-Type "application/json; charset=utf-8"
        Header set Cache-Control "no-cache, no-store, must-revalidate"
    </FilesMatch>
</IfModule>

# Configuración de CORS para desarrollo
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    Header always set Access-Control-Allow-Credentials "true"
</IfModule>

# Manejar solicitudes OPTIONS para CORS
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=204,L]

# Redireccionar a login.html como página principal
DirectoryIndex frontend/html/login.html

# Rutas para el frontend
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} ^/frontend/
RewriteRule ^frontend/(.*)$ frontend/$1 [L]

# Rutas para la API
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} ^/api/
RewriteRule ^api/(.*)$ backend/php/api/$1 [L]

# Proteger archivos sensibles
<Files ".env">
    Order allow,deny
    Deny from all
</Files>

<Files "*.log">
    Order allow,deny
    Deny from all
</Files>

# Configuración de errores personalizados
ErrorDocument 404 /frontend/html/404.html
ErrorDocument 500 /frontend/html/500.html

# Configuración PHP
<IfModule mod_php.c>
    php_flag display_errors On
    php_flag log_errors On
    php_value error_log logs/php_errors.log
    php_value max_execution_time 300
    php_value memory_limit 256M
</IfModule>

# Compresión GZIP
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>
